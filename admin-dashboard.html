<!DOCTYPE html>
<html>
<head>
  <title>ğŸ‘‘ ZaraFix Admin Dashboard</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <style>
    body { font-family: sans-serif; background: #f2f2f2; padding: 20px; margin: 0; }
    h1, h2 { text-align: center; }

    .nav-buttons {
      display: flex; justify-content: center; flex-wrap: wrap; gap: 12px; margin: 20px 0;
    }
    .nav-buttons button {
      padding: 14px 22px;
      font-size: 16px;
      border: none;
      border-radius: 12px;
      background: linear-gradient(to right, #1e88e5, #42a5f5);
      box-shadow: 0 6px 15px rgba(0, 0, 0, 0.2);
      color: white;
      cursor: pointer;
      transition: transform 0.2s;
    }
    .nav-buttons button:hover {
      transform: scale(1.05);
    }

    .grid {
      display: flex; flex-wrap: wrap; justify-content: center; gap: 16px;
    }
    .card {
      background: white;
      padding: 16px;
      border-radius: 12px;
      box-shadow: 0 6px 12px rgba(0,0,0,0.15);
      width: 90%;
      max-width: 340px;
    }
    .btn {
      padding: 8px 12px;
      margin-top: 10px;
      border: none;
      border-radius: 8px;
      color: white;
      cursor: pointer;
    }
    .approve { background-color: #27ae60; }
    .recharge { background-color: #8e44ad; }
    a { text-decoration: none; }

    .section { display: none; margin-top: 30px; }
    .active { display: block; }
  </style>
</head>
<body>

  <h1>ğŸ‘‘ ZaraFix Admin Dashboard</h1>

  <div class="nav-buttons">
    <button onclick="showSection('rechargeSection')">ğŸ”‹ Recharge</button>
    <button onclick="showSection('posterSection')">ğŸ‘· Posters</button>
    <button onclick="showSection('userSection')">ğŸ§‘â€ğŸ’» Users</button>
  </div>

  <!-- Recharge Section -->
  <div id="rechargeSection" class="section">
    <h2>ğŸ”‹ Recharge Requests</h2>
    <div id="rechargeList" class="grid"></div>
  </div>

  <!-- Poster Section -->
  <div id="posterSection" class="section">
    <h2>ğŸ‘· All Service Providers</h2>
    <div id="posterList" class="grid"></div>
  </div>

  <!-- User Section -->
  <div id="userSection" class="section">
    <h2>ğŸ§‘â€ğŸ’» All Users & Requests</h2>
    <div id="userList" class="grid"></div>
  </div>

  <!-- Firebase SDK -->
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-auth.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>

  <script>
    const firebaseConfig = {
      apiKey: "AIzaSyCH17_8W_UPmPt4KqpCaV7BpN6KsA4a67E",
      authDomain: "zara-fix.firebaseapp.com",
      databaseURL: "https://zara-fix-default-rtdb.firebaseio.com",
      projectId: "zara-fix",
      storageBucket: "zara-fix.appspot.com",
      messagingSenderId: "476473209200",
      appId: "1:476473209200:web:9f6efe6c32fd4248949fb5"
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();
    const auth = firebase.auth();

    auth.onAuthStateChanged(user => {
      if (!user) return location.href = "index.html";
      db.ref("users/" + user.uid).once("value").then(snap => {
        if (snap.exists() && snap.val().isAdmin === true) {
          loadRechargeRequests();
          loadPosters();
          loadUsers();
          showSection('rechargeSection'); // default
        } else {
          alert("Access denied.");
          location.href = "index.html";
        }
      });
    });

    function showSection(id) {
      document.querySelectorAll(".section").forEach(s => s.classList.remove("active"));
      document.getElementById(id).classList.add("active");
    }

    function loadRechargeRequests() {
      const list = document.getElementById("rechargeList");
      db.ref("rechargeRequests").once("value").then(snapshot => {
        list.innerHTML = "";
        snapshot.forEach(userSnap => {
          const userId = userSnap.key;
          userSnap.forEach(reqSnap => {
            const r = reqSnap.val();
            if (r.status === "pending") {
              list.innerHTML += `
                <div class="card">
                  <b>${r.name}</b><br>
                  UID: <b>${userId}</b><br>
                  ğŸ“ <a href="https://wa.me/${r.whatsapp}" target="_blank">${r.whatsapp}</a><br>
                  ğŸ’° â‚¹${r.amount}<br>
                  â° ${new Date(r.timestamp).toLocaleString()}<br>
                  <img src="${r.image}" style="width:100%;border-radius:10px;margin-top:10px;"><br>
                  <button class="btn approve" onclick="approveRecharge('${userId}', '${reqSnap.key}')">âœ… Approve</button>
                </div>
              `;
            }
          });
        });
      });
    }

    function approveRecharge(uid, key) {
      const walletRef = db.ref("posters/" + uid + "/wallet");
      walletRef.once("value").then(snap => {
        const current = snap.val() || 0;
        walletRef.set(current + 100);
        db.ref("rechargeRequests/" + uid + "/" + key).update({ status: "approved" });
        alert("âœ… Recharge Approved");
        loadRechargeRequests();
      });
    }

    function loadPosters() {
      const posterList = document.getElementById("posterList");
      db.ref("posters").once("value").then(snapshot => {
        posterList.innerHTML = "";
        snapshot.forEach(child => {
          const p = child.val();
          const uid = child.key;
          posterList.innerHTML += `
            <div class="card">
              <b>${p.name}</b><br>
              ğŸ› ï¸ ${p.category}<br>
              ğŸ“ ${p.address}<br>
              ğŸ“ <a href="https://wa.me/${p.whatsapp}" target="_blank">${p.whatsapp}</a><br>
              UID: <b>${uid}</b><br>
              ğŸ’° â‚¹${p.wallet || 0}
            </div>
          `;
        });
      });
    }

    function loadUsers() {
      const userList = document.getElementById("userList");
      db.ref("requests").once("value").then(snapshot => {
        userList.innerHTML = "";
        snapshot.forEach(userSnap => {
          const userId = userSnap.key;
          const inner = [];
          userSnap.forEach(reqSnap => {
            const r = reqSnap.val();
            const accepted = r.acceptedBy
              ? Object.values(r.acceptedBy).map(x => x.name).join(", ")
              : "None";
            inner.push(`
              <div style="margin-top:10px;border-top:1px solid #ddd;padding-top:6px;">
                Issue: ${r.issue}<br>
                ğŸ“ ${r.address}, ${r.pincode}<br>
                ğŸ“ <a href="https://wa.me/${r.whatsapp}" target="_blank">${r.whatsapp}</a><br>
                âœ… Accepted by: ${accepted}
              </div>
            `);
          });
          userList.innerHTML += `
            <div class="card">
              ğŸ‘¤ <b>${userId}</b>
              ${inner.join("")}
            </div>
          `;
        });
      });
    }
  </script>
</body>
</html>
